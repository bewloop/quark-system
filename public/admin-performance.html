<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Performance | QUARK</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f5f5f5;
}

.top-actions {
  position: fixed;
  top: 16px;
  left: 16px;
  right: 16px;
  display: flex;
  justify-content: space-between;
}

.top-actions button {
  padding: 8px 14px;
  border-radius: 6px;
  border: none;
  background: #000;
  color: #fff;
  cursor: pointer;
}

.container {
  max-width: 1100px;
  margin: 90px auto 40px;
  background: #fff;
  padding: 28px;
  border-radius: 12px;
}

h2 {
  margin-top: 0;
  text-align: center;
}

.filters {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
  align-items: center;
  flex-wrap: wrap;
}

.filters input,
.filters button {
  padding: 8px 12px;
  font-size: 14px;
}

.filters button {
  background: #111;
  color: #fff;
  border-radius: 6px;
  border: none;
  cursor: pointer;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

th, td {
  padding: 10px;
  border-bottom: 1px solid #ddd;
  text-align: center;
}

th {
  background: #000;
  color: #fff;
}

.summary {
  margin-top: 20px;
  font-size: 14px;
}
</style>
</head>

<body>

<div class="top-actions">
  <button onclick="location.href='index.html'">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
  <button onclick="logout()">Logout</button>
</div>

<div class="container">

  <h2>üìä Performance Staff</h2>

  <div class="filters">
    <label>‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:
      <input type="date" id="from">
    </label>

    <label>‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:
      <input type="date" id="to">
    </label>

    <button onclick="loadPerformance()">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
        <th>‡∏ï‡∏±‡∏î</th>
        <th>‡∏õ‡∏£‡∏∞‡∏Å‡∏ö</th>
        <th>‡∏Å‡∏∏‡πä‡∏ô</th>
        <th>QC</th>
        <th>‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á (‡∏ö‡∏≤‡∏ó)</th>
      </tr>
    </thead>
    <tbody id="rows">
      <tr><td colspan="6">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</td></tr>
    </tbody>
  </table>

  <div class="summary" id="summary"></div>

</div>

<script>
/* ===== ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏ï‡πà‡∏≠‡∏Ç‡∏±‡πâ‡∏ô ===== */
const RATE = {
  cut: 20,
  assemble: 25,
  sew: 30,
  qc: 15
};

async function authFetch(url) {
  const res = await fetch(url, { credentials: 'include' });
  if (res.status === 401 || res.status === 403) {
    location.href = 'login.html';
  }
  return res;
}

async function loadPerformance() {
  const from = document.getElementById('from').value;
  const to = document.getElementById('to').value;
  const tbody = document.getElementById('rows');
  const summary = document.getElementById('summary');

  if (!from || !to) {
    alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà');
    return;
  }

  tbody.innerHTML = `<tr><td colspan="6">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>`;
  summary.innerHTML = '';

  const res = await authFetch(`/api/admin/performance?from=${from}&to=${to}`);
  const data = await res.json();

  if (!data.length) {
    tbody.innerHTML = `<tr><td colspan="6">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
    return;
  }

  let total = 0;
  tbody.innerHTML = '';

  data.forEach(s => {
    const wage =
      (s.cut || 0) * RATE.cut +
      (s.assemble || 0) * RATE.assemble +
      (s.sew || 0) * RATE.sew +
      (s.qc || 0) * RATE.qc;

    total += wage;

    tbody.innerHTML += `
      <tr>
        <td><strong>${s.staff}</strong></td>
        <td>${s.cut || 0}</td>
        <td>${s.assemble || 0}</td>
        <td>${s.sew || 0}</td>
        <td>${s.qc || 0}</td>
        <td>${wage.toLocaleString()}</td>
      </tr>
    `;
  });

  summary.innerHTML =
    `üí∞ ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <strong>${total.toLocaleString()} ‡∏ö‡∏≤‡∏ó</strong>`;
}

async function logout() {
  await fetch('/api/logout', { method: 'POST' });
  location.href = 'login.html';
}

/* ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ */
const today = new Date().toISOString().slice(0,10);
from.value = today;
to.value = today;
</script>

</body>
</html>
